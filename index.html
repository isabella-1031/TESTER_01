<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Digital Dreamweavers</title>
  <!-- p5.js Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <!-- Link to external CSS -->
  <link rel="stylesheet" href="style.css">
  <style>
    /* You can keep additional inline styles here if needed */
    /* For example, if you want to override or ensure certain elements have the custom cursor */
  </style>
</head>
<body>
  <h1>Digital Dreamweavers</h1>
  
  <!-- Color Palette -->
   <div id="colorPalette">
  <span class="colorOption selected" data-color="#c30202" data-cursor="CURSOR_RED.png" style="background-color: #a30505;"></span>
  <span class="colorOption" data-color="#180f0f" data-cursor="CURSOR_BLACK.png" style="background-color: #180f0f;"></span>
  <span class="colorOption" data-color="#e2ac1d" data-cursor="CURSOR_YELLOW.png" style="background-color: #e2ac1d;"></span>
  <span class="colorOption" data-color="#ffffff" data-cursor="CURSOR_WHITE.png" style="background-color: #ffffff;"></span>
  <span class="colorOption" data-color="#242968" data-cursor="CURSOR_BLUE.png" style="background-color: #242968;"></span>
  </div>
  
<!-- Pixel art grid container (loom frame) -->
<div id="canvasContainer">
  <table id="pixelCanvas"></table>
</div>
  
  <!-- p5.js Sketch -->
  <script src="sketch.js"></script>
  
  <!-- Pixel Art Grid Script (reset & undo functionality) -->
  <script>
    const pixelCanvas = document.getElementById("pixelCanvas");
    const colorOptions = document.querySelectorAll(".colorOption");
    let selectedColor = "#c30202"; // default selected color
    let isMouseDown = false;
    const gridSize = 20;
    let undoStack = []; // Global undo stack to record cell changes

    // Update selected color on palette click.
  colorOptions.forEach(option => {
  option.addEventListener("click", () => {
    selectedColor = option.getAttribute("data-color");
    colorOptions.forEach(opt => opt.classList.remove("selected"));
    option.classList.add("selected");
    
    const cursorFile = option.getAttribute("data-cursor");
    console.log("Changing cursor to:", cursorFile);  // Debug output
    if (cursorFile) {
      document.body.style.cursor = `url("${cursorFile}") 16 16, auto`;
      const canvasEl = document.querySelector("canvas");
      if (canvasEl) {
        canvasEl.style.cursor = `url("${cursorFile}") 16 16, auto`;
      }
      document.querySelectorAll("#pixelCanvas td").forEach(cell => {
        cell.style.cursor = `url("${cursorFile}") 16 16, auto`;
      });
    }
  });
});


const columns = 27; // For 1080px width: 27 columns x 40px = 1080px
const rows = 50;    // Adjust this number as needed for vertical space

// Clear any previous grid content (if necessary)
pixelCanvas.innerHTML = "";

// Create the grid using separate rows and columns:
for (let i = 0; i < rows; i++) {
  const row = pixelCanvas.insertRow();
  for (let j = 0; j < columns; j++) {
    const cell = row.insertCell();
    cell.addEventListener("mousedown", (e) => {
      e.preventDefault(); // Prevent text selection.
      let previousColor = cell.style.backgroundColor || "";
      undoStack.push({ cell: cell, previousColor: previousColor });
      cell.style.backgroundColor = selectedColor;
      isMouseDown = true;
    });
    cell.addEventListener("mouseover", () => {
      if (isMouseDown) {
        let previousColor = cell.style.backgroundColor || "";
        undoStack.push({ cell: cell, previousColor: previousColor });
        cell.style.backgroundColor = selectedColor;
      }
    });
  }
}


    // Stop drawing when the mouse button is released.
    document.addEventListener("mouseup", () => {
      isMouseDown = false;
    });

    // Listen for key events for Reset (Backspace) and Undo (Enter).
    document.addEventListener("keydown", (e) => {
      // Backspace resets the entire grid.
      if (e.key === "Backspace") {
        e.preventDefault(); // Prevent browser's default back action.
        document.querySelectorAll("#pixelCanvas td").forEach(cell => {
          cell.style.backgroundColor = "";
        });
        undoStack = []; // Clear undo history.
      }
      // Enter undoes the most recent action.
      else if (e.key === "Enter") {
        e.preventDefault();
        if (undoStack.length > 0) {
          const lastAction = undoStack.pop();
          lastAction.cell.style.backgroundColor = lastAction.previousColor;
        }
      }
    });
  </script>
</body>
</html>
